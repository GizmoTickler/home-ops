---
apiVersion: v1
kind: ConfigMap
metadata:
  name: netbox-oidc-config
data:
  oidc.py: |
    import os

    # OIDC Configuration for PocketID
    # Add OIDC backend to authentication backends
    AUTHENTICATION_BACKENDS = [
        'social_core.backends.open_id_connect.OpenIdConnectAuth',
        'netbox.authentication.ObjectPermissionBackend',
    ]

    # Social Auth settings - endpoint from environment variable
    SOCIAL_AUTH_OIDC_OIDC_ENDPOINT = os.environ.get('SOCIAL_AUTH_OIDC_ENDPOINT', '')
    SOCIAL_AUTH_OIDC_SCOPE = ['openid', 'profile', 'email']

    # Auto-create users from OIDC
    SOCIAL_AUTH_AUTO_CREATE_USERS = True

    # Map OIDC claims to user attributes
    SOCIAL_AUTH_OIDC_USERNAME_KEY = 'preferred_username'
