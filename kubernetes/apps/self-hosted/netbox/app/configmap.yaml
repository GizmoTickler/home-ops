---
apiVersion: v1
kind: ConfigMap
metadata:
  name: netbox-oidc-config
data:
  oidc.yaml: |
    # OIDC Configuration for PocketID
    # Note: AUTHENTICATION_BACKENDS is set via remoteAuth.backends in HelmRelease

    # OIDC endpoint (substituted by Flux)
    SOCIAL_AUTH_OIDC_OIDC_ENDPOINT: "https://id.${SECRET_DOMAIN}"

    # Map OIDC claims to user attributes
    SOCIAL_AUTH_OIDC_USERNAME_KEY: preferred_username

    # OIDC scopes
    SOCIAL_AUTH_OIDC_SCOPE:
      - openid
      - profile
      - email

    # Security settings for HTTPS behind reverse proxy
    SESSION_COOKIE_SECURE: true
    CSRF_COOKIE_SECURE: true
    CSRF_TRUSTED_ORIGINS:
      - "https://netbox.${SECRET_DOMAIN}"
      - "https://id.${SECRET_DOMAIN}"
